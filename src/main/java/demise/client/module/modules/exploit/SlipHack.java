package demise.client.module.modules.exploit;

import demise.client.module.Module;
import demise.client.module.setting.impl.DescriptionSetting;
import demise.client.module.setting.impl.TickSetting;
import demise.client.utils.MathUtils;
import demise.client.utils.Utils;
import demise.client.utils.event.ReceivePacketEvent;
import net.minecraft.client.entity.EntityPlayerSP;
import net.minecraft.entity.Entity;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.S02PacketChat;
import net.minecraft.network.play.server.S45PacketTitle;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.TickEvent;

import java.util.Arrays;
import java.util.List;

import static demise.client.utils.Utils.Java.randomInt;

public class SlipHack extends Module {
    public static DescriptionSetting rat;
    private static TickSetting chat;

    public SlipHack() {
        super("SlipHack", ModuleCategory.exploit, "");

        this.registerSetting(rat = new DescriptionSetting("from weedhack"));
        this.registerSetting(chat = new TickSetting("Display chat", true));
    }

    private final List<String> messages = Arrays.asList(
            "bridging N2 to cosmic rays",
            "beaming at opponent's computer",
            "injecting Advanced Neural Network (ANN) AI player movement and mouse input",
            "injecting C++ extern alio code, injection modules and SlipHack™",
            "slipping up enemies",
            "demise forge mixin technologies™",
            "enabling Ultimate Premium AutoClicker Bypass (YPCB)",
            "injecting demise on system startup using demiseHook reborn v6 by Alan Wood industries",
            "enabling Augustus skyscraper disabler using the EpicGames live concert API",
            "activating AI machine learning thermodynamic neuralink backdoor",
            "targeting SlipHack to real life people using neuralink",
            "activating Hypixel interdimensional movement disabler",
            "abusing nano-particle atom biosphere velocity packet",
            "unpatching galaxy strafe"
    );

    private long lastMessageTime = 0;
    private int progress = 0;
    private int wait = 0;
    private String name = "";

    @Override
    public void onEnable() {
        lastMessageTime = System.currentTimeMillis();
        progress = 0;
        wait = 0;
    }

    @SubscribeEvent
    public void onRenderTick(TickEvent.RenderTickEvent e) {
        this.setTag(progress == 100 ? progress + "% - Ready" : progress + "%");
    }

    public void update() {
        wait++;

        if (wait >= randomInt(5, 50)) {
            if (progress < 100) {
                progress += randomInt(0, 25);
            }

            wait = 0;
        }

        if (progress > 100) {
            progress = 100;
        }
    }

    @SubscribeEvent
    public void onPacket(ReceivePacketEvent e) {
        if (!Utils.Player.nullCheck()) {
            return;
        }

        Packet<?> packet = e.getPacket();

        if (packet instanceof S02PacketChat) {
            S02PacketChat s02 = (S02PacketChat) e.getPacket();
            String h = s02.getChatComponent().getUnformattedText();

            for (Entity player : mc.theWorld.loadedEntityList) {
                if (player instanceof EntityPlayerSP) {
                    if (h.contains(player.getName())) {
                        name = player.getName();
                    }
                }
            }

            if (progress == 100) {
                if (h.contains("fell out of the world") || h.contains("fell from a high place")) {
                    Utils.Player.sendMessageToSelf("Slipped up " + name);
                    progress = 0;
                }
            }
        }
    }

    @SubscribeEvent
    public void playerTickEvent(TickEvent.PlayerTickEvent event) {
        long currentTime = System.currentTimeMillis();
        if (currentTime - lastMessageTime > (MathUtils.randomFloat(50, 250) * 50)) {
            String message = messages.get(randomInt(0, messages.size()));

            if (chat.isToggled()) {
                Utils.Player.sendMessageToSelf(message);
            }

            lastMessageTime = currentTime;
        }
    }
}