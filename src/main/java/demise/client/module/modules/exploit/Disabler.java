package demise.client.module.modules.exploit;

import demise.client.module.Module;
import demise.client.module.setting.impl.TickSetting;
import demise.client.utils.Utils;
import demise.client.utils.event.ReceivePacketEvent;
import demise.client.utils.packet.PacketUtils;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.network.play.server.S08PacketPlayerPosLook;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.TickEvent;

public class Disabler extends Module {
    public static TickSetting intaveSprintScaffold, miniblox, debug;

    public Disabler() {
        super("Disabler", ModuleCategory.exploit);

        this.registerSetting(intaveSprintScaffold = new TickSetting("Intave Sprint Scaffold", false));
        this.registerSetting(miniblox = new TickSetting("Miniblox", false));
        this.registerSetting(debug = new TickSetting("Debug", false));
    }

    @SubscribeEvent
    public void onTick(TickEvent.PlayerTickEvent e) {
        //if this doesn't work blame @liquidsquid1, not me
        if (intaveSprintScaffold.isToggled() && mc.thePlayer.ticksExisted > 80) {
            mc.thePlayer.sendQueue.addToSendQueue(
                    new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.START_SNEAKING)
            );
            mc.thePlayer.sendQueue.addToSendQueue(
                    new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.STOP_SNEAKING)
            );
        }
    }

    @SubscribeEvent
    public void onPacket(ReceivePacketEvent e) {
        if (e.getPacket() instanceof S08PacketPlayerPosLook && mc.thePlayer.ticksExisted > 80) {
            e.setCanceled(true);

            if (debug.isToggled()) {
                Utils.Player.sendMessageToSelf("received s08");
            }

            S08PacketPlayerPosLook packet = (S08PacketPlayerPosLook) e.getPacket();

            PacketUtils.sendPacket(mc, new C03PacketPlayer.C06PacketPlayerPosLook(
                            packet.getX(),
                            packet.getY(),
                            packet.getZ(),
                            packet.getYaw(),
                            packet.getPitch(),
                            mc.thePlayer.onGround
                    )
            );

            if (debug.isToggled()) {
                Utils.Player.sendMessageToSelf("sent 1st c06");
            }

            PacketUtils.sendPacket(mc, new C03PacketPlayer.C06PacketPlayerPosLook(
                            mc.thePlayer.posX,
                            mc.thePlayer.posY,
                            mc.thePlayer.posZ,
                            mc.thePlayer.rotationYaw,
                            mc.thePlayer.rotationPitch,
                            mc.thePlayer.onGround
                    )
            );

            if (debug.isToggled()) {
                Utils.Player.sendMessageToSelf("sent 2nd c06");
            }
        }
    }
}